- hosts: all
  vars:
  - backup_name: clawfinger
  - backup_engine: restic
  - backup_restic_repo: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      62316633666663633866363736373830396230336235383062636536383737313863643166623133
      3066313939363161633036363062633964333262366637320a373032373235636663373034323232
      34316136306364633866313936353539666237343135303430653062616261623965326364656431
      6363613337346430350a653636636264323462366335396431636633333931303132333133616366
      65613439356265356566356466326333353339386561303564656166383738616234
  - backup_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34383663643431393661343432316331396332646531653030326234333535353331646361333133
      3165353636396435353164396438336230333066343761640a666235393135613538343339323037
      62326331646533373866643536376164393166393735616234333834373736613832316638333962
      3865623462626264350a313937313962343032623832626166653964626363383136316339366366
      6163
  - backup_encryption_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      37316162626265326630663964633863323265303066313532373436663336386463656139333364
      6361326137393039396265376634343031343732383535610a393939356562333638613630346434
      61623335353236653163626365636661316339353661303831383830663933663366646138313966
      3137616461383036650a316334363031303266613431623234316635336265366133376537323061
      39303538343064346562303533643739326266323862623932386261306436386265
  - B2_ACCOUNT_ID: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      62313736636164616136393661313534623931363363666166663732343230363365613738663736
      3331663066653864653362663565633261336561333564380a633033306265386661663134663133
      62376138633132303130386463646433663931396361633162363763373964376636323635663637
      6539376265323138650a653737636131356337656566333631323431363864616663353934303635
      33373066613130623138346634313561316564336262343835343865353965346135
  - B2_ACCOUNT_KEY: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31663262363166313962616266613839333035616438343132343763643732363835393937343638
      3863393738363330346365306436333137363439366632650a663936353137306630616630373737
      63653039613565306135343831386134643334666361643236323861383065363963373333386639
      6266313631306265650a646432383430363263633630316461666231353235636531643266633536
      62366131373539346434353463323930346133393966646230663234323964353233
  - backup_target_dir: ""

  tasks:
  - name: Set `target_location`
    set_fact:
      target_location: "{{ backup_restic_repo }}:{{ backup_target_dir }}"
  - name: Show backups
    expect:
      command: restic -r {{ target_location }}/{{ backup_name }} list snapshots
      responses:
        passphrase: "{{ backup_encryption_key }}"
    register: backups

  - name: Print backup status
    debug:
      var: backups.stdout_lines